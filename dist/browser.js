"use strict";var CDFormLibrary=(()=>{var V={mask:/^.*$/,preprocessors:[],postprocessors:[],plugins:[],overwriteMode:"shift"},K=class{constructor(){this.now=null,this.past=[],this.future=[]}undo(){let e=this.past.pop();e&&this.now&&(this.future.push(this.now),this.updateElement(e,"historyUndo"))}redo(){let e=this.future.pop();e&&this.now&&(this.past.push(this.now),this.updateElement(e,"historyRedo"))}updateHistory(e){if(!this.now){this.now=e;return}let n=this.now.value!==e.value,s=this.now.selection.some((o,r)=>o!==e.selection[r]);!n&&!s||(n&&(this.past.push(this.now),this.future=[]),this.now=e)}updateElement(e,n){this.now=e,this.updateElementState(e,{inputType:n,data:null})}};function et(t,...e){return e.every(({value:n})=>n===t.value)}function J(t,...e){return e.every(({value:n,selection:s})=>n===t.value&&s[0]===t.selection[0]&&s[1]===t.selection[1])}function ve({value:t,selection:e},n,s){let[o,r]=e,i=typeof s=="function"?s({value:t,selection:e}):s;return{value:t,selection:i==="replace"?[o,Math.max(o+n.length,r)]:[o,r]}}function U(t){return typeof t=="string"}function be(t,e,n,s){let o="";for(let r=e.length;r<t.length;r++){let i=t[r]||"",l=s?.value[r]===i;if(!U(i)||i===n&&!l)return o;o+=i}return o}function Se(t,e){return Array.isArray(e)?t.length===e.length&&Array.from(t).every((n,s)=>{let o=e[s]||"";return U(o)?n===o:n.match(o)}):e.test(t)}function tt(t,e,n){let s=null,o=null,r=Array.from(t.value).reduce((l,a,c)=>{let u=be(e,l,a,n),d=l+u,m=e[d.length]||"";return s===null&&c>=t.selection[0]&&(s=d.length),o===null&&c>=t.selection[1]&&(o=d.length),U(m)?d+m:a.match(m)?d+a:u.startsWith(a)?d:l},""),i=be(e,r,"",n);return{value:Se(r+i,e)?r+i:r,selection:[s??r.length,o??r.length]}}function nt({value:t,selection:e},n){let[s,o]=e,r=s,i=o,l=Array.from(t).reduce((a,c,u)=>{let d=a+c;return s===u&&(r=a.length),o===u&&(i=a.length),d.match(n)?d:a},"");return{value:l,selection:[Math.min(r,l.length),Math.min(i,l.length)]}}function O(t,e,n=null){if(Se(t.value,e))return t;let{value:s,selection:o}=Array.isArray(e)?tt(t,e,n):nt(t,e);return{selection:o,value:Array.isArray(e)?s.slice(0,e.length):s}}function Ae(t,e){if(!Array.isArray(e))return t;let[n,s]=t.selection,o=[],r=Array.from(t.value).reduce((i,l,a)=>{let c=e[a]||"";return a===n&&o.push(i.length),a===s&&o.push(i.length),U(c)&&c===l?i:i+l},"");return o.length<2&&o.push(...new Array(2-o.length).fill(r.length)),{value:r,selection:[o[0],o[1]]}}var C=class{constructor(e,n){this.maskOptions=n,this.unmaskInitialState={value:"",selection:[0,0]},this.value="",this.selection=[0,0];let s=this.getMaskExpression(e),{value:o,selection:r}=O(e,s);this.unmaskInitialState=Ae({value:o,selection:r},s),this.value=o,this.selection=r}addCharacters(e){let{value:n,selection:s,maskOptions:o}=this,r={value:n,selection:s},{selection:[i,l]}=ve(r,e,o.overwriteMode),a=this.getMaskExpression({value:n.slice(0,i)+e+n.slice(l),selection:[i+e.length,i+e.length]}),[c,u]=ve(this.unmaskInitialState,e,o.overwriteMode).selection,d=this.unmaskInitialState.value.slice(0,c)+e,m=d.length,g=O({value:d+this.unmaskInitialState.value.slice(u),selection:[m,m]},a,r),f=n.slice(0,i),p=O({value:d,selection:[m,m]},a,r);if(p.value===f||p.value.length<f.length&&Ae(p,a).value===this.unmaskInitialState.value.slice(0,c)||J(this,g))throw new Error("Invalid mask value");this.value=g.value,this.selection=g.selection}deleteCharacters(){let[e,n]=this.selection;if(e===n||!n)return;let{value:s}=this,o=this.getMaskExpression({value:s.slice(0,e)+s.slice(n),selection:[e,e]}),r={value:s},[i,l]=this.unmaskInitialState.selection,a=this.unmaskInitialState.value.slice(0,i)+this.unmaskInitialState.value.slice(l),c=O({value:a,selection:[i,i]},o,r);this.value=c.value,this.selection=c.selection}getMaskExpression(e){let{mask:n}=this.maskOptions;return typeof n=="function"?n(e):n}},_=class{constructor(e){this.element=e,this.listeners=[]}listen(e,n,s){let o=n;this.element.addEventListener(e,o,s),this.listeners.push(()=>this.element.removeEventListener(e,o,s))}destroy(){this.listeners.forEach(e=>e())}},M={CTRL:1,ALT:2,SHIFT:4,META:8},D={Y:89,Z:90};function T(t,e,n){return t.ctrlKey===!!(e&M.CTRL)&&t.altKey===!!(e&M.ALT)&&t.shiftKey===!!(e&M.SHIFT)&&t.metaKey===!!(e&M.META)&&t.keyCode===n}function st(t){return T(t,M.CTRL,D.Y)||T(t,M.CTRL|M.SHIFT,D.Z)||T(t,M.META|M.SHIFT,D.Z)}function ot(t){return T(t,M.CTRL,D.Z)||T(t,M.META,D.Z)}function Q(t,e){var n;let s=t.value;if(typeof e=="string")t.value=e;else{let[o,r]=e.selection;t.value=e.value,t.matches(":focus")&&((n=t.setSelectionRange)===null||n===void 0||n.call(t,o,r))}t.value!==s&&t.dispatchEvent(new Event("input",{bubbles:!0}))}function rt({value:t,selection:e},n){let[s,o]=e;if(s!==o)return[s,o];let r=n?t.slice(s).indexOf(`
`)+1||t.length:t.slice(0,o).lastIndexOf(`
`)+1;return[n?s:r,n?r:o]}function it({value:t,selection:e},n){let[s,o]=e;return s!==o?[s,o]:(n?[s,o+1]:[s-1,o]).map(i=>Math.min(Math.max(i,0),t.length))}var at=/\s+$/g,lt=/^\s+/g,we=/\s/;function ct({value:t,selection:e},n){let[s,o]=e;if(s!==o)return[s,o];if(n){let a=t.slice(s),[c]=a.match(lt)||[""],u=a.trimStart().search(we);return[s,u!==-1?s+c.length+u:t.length]}let r=t.slice(0,o),[i]=r.match(at)||[""],l=r.trimEnd().split("").reverse().findIndex(a=>we.exec(a));return[l!==-1?o-i.length-l:0,o]}function F(t=[]){return(e,...n)=>t.reduce((s,o)=>Object.assign(Object.assign({},s),o(s,...n)),e)}function Me(t,e){let n=Object.assign(Object.assign({},V),e),s=F(n.preprocessors),o=F(n.postprocessors),r=typeof t=="string"?{value:t,selection:[0,0]}:t,{elementState:i}=s({elementState:r,data:""},"validation"),l=new C(i,n),{value:a,selection:c}=o(l,r);return typeof t=="string"?a:{value:a,selection:c}}function ut(){return t=>{let e=new _(t),n=!1,s,o=t.value;return e.listen("keydown",({key:r})=>{n=r==="Unidentified"}),e.listen("beforeinput",r=>{s=r,o=t.value}),e.listen("input",r=>{n&&s.defaultPrevented&&s.inputType==="deleteContentBackward"&&r.inputType==="deleteContentBackward"&&(t.value=o)},{capture:!0}),()=>e.destroy()}}var X=" ";function dt(){let t="",e=0,n=null,s=!1;return o=>{let r=new _(o);return r.listen("beforeinput",i=>{var l,a;let{value:c,selectionStart:u,selectionEnd:d}=o,m=n?.inputType==="insertText"&&n?.data===X&&!c.slice(0,Number(d)).endsWith(X);i.inputType==="insertText"&&i.data===`.${X}`&&(n?.inputType==="deleteContentBackward"&&s?(o.value=t,(l=o.setSelectionRange)===null||l===void 0||l.call(o,e,e)):m&&((a=o.setSelectionRange)===null||a===void 0||a.call(o,u,u))),s=m,n=i,t=c,e=Number((m?e:d)===c.length?d:u)}),()=>r.destroy()}}var mt=[dt(),ut()],x=class extends K{constructor(e,n){super(),this.element=e,this.maskitoOptions=n,this.isTextArea=this.element.nodeName==="TEXTAREA",this.eventListener=new _(this.element),this.options=Object.assign(Object.assign({},V),this.maskitoOptions),this.upcomingElementState=null,this.preprocessor=F(this.options.preprocessors),this.postprocessor=F(this.options.postprocessors),this.teardowns=this.options.plugins.concat(mt).map(s=>s(this.element,this.options)),this.updateHistory(this.elementState),this.eventListener.listen("keydown",s=>{if(st(s))return s.preventDefault(),this.redo();if(ot(s))return s.preventDefault(),this.undo()}),this.eventListener.listen("beforeinput",s=>{var o,r,i;let l=s.inputType.includes("Forward");switch(this.updateHistory(this.elementState),s.inputType){case"deleteByCut":case"deleteContentBackward":case"deleteContentForward":return this.handleDelete({event:s,isForward:l,selection:it(this.elementState,l)});case"deleteHardLineBackward":case"deleteHardLineForward":case"deleteSoftLineBackward":case"deleteSoftLineForward":return this.handleDelete({event:s,isForward:l,selection:rt(this.elementState,l),force:!0});case"deleteWordBackward":case"deleteWordForward":return this.handleDelete({event:s,isForward:l,selection:ct(this.elementState,l)});case"historyRedo":return s.preventDefault(),this.redo();case"historyUndo":return s.preventDefault(),this.undo();case"insertCompositionText":return;case"insertLineBreak":case"insertParagraph":return this.handleEnter(s);case"insertReplacementText":return;case"insertFromDrop":case"insertFromPaste":case"insertText":default:return this.handleInsert(s,(i=(o=s.data)!==null&&o!==void 0?o:(r=s.dataTransfer)===null||r===void 0?void 0:r.getData("text/plain"))!==null&&i!==void 0?i:"")}}),this.eventListener.listen("input",()=>{this.upcomingElementState&&!J(this.upcomingElementState,this.elementState)&&this.updateElementState(this.upcomingElementState),this.upcomingElementState=null},{capture:!0}),this.eventListener.listen("input",({inputType:s})=>{s!=="insertCompositionText"&&(this.ensureValueFitsMask(),this.updateHistory(this.elementState))}),this.eventListener.listen("compositionend",()=>{this.ensureValueFitsMask(),this.updateHistory(this.elementState)})}destroy(){this.eventListener.destroy(),this.teardowns.forEach(e=>e?.())}updateElementState({value:e,selection:n},s){let o=this.elementState.value;this.updateValue(e),this.updateSelectionRange(n),s&&o!==e&&this.dispatchInputEvent(s)}get elementState(){let{value:e,selectionStart:n,selectionEnd:s}=this.element;return{value:e,selection:[n??0,s??0]}}get maxLength(){let{maxLength:e}=this.element;return e===-1?1/0:e}updateSelectionRange([e,n]){var s;let{element:o}=this;o.matches(":focus")&&(o.selectionStart!==e||o.selectionEnd!==n)&&((s=o.setSelectionRange)===null||s===void 0||s.call(o,e,n))}updateValue(e){(this.element.value!==e||this.element.isContentEditable)&&(this.element.value=e)}ensureValueFitsMask(){this.updateElementState(Me(this.elementState,this.options),{inputType:"insertText",data:null})}dispatchInputEvent(e={inputType:"insertText",data:null}){globalThis.InputEvent&&this.element.dispatchEvent(new InputEvent("input",Object.assign(Object.assign({},e),{bubbles:!0,cancelable:!1})))}handleDelete({event:e,selection:n,isForward:s}){let o={value:this.elementState.value,selection:n},{elementState:r}=this.preprocessor({elementState:o,data:""},s?"deleteForward":"deleteBackward"),i=new C(r,this.options);i.deleteCharacters();let l=this.postprocessor(i,o);if(et(o,r,i,l)){let[a,c]=r.selection;return e.preventDefault(),this.updateSelectionRange(s?[c,c]:[a,a])}this.upcomingElementState=l}handleInsert(e,n){let{options:s,maxLength:o,elementState:r}=this,[i,l]=r.selection,{elementState:a,data:c=n}=this.preprocessor({data:n,elementState:r},"insert"),u=new C(a,s);try{u.addCharacters(c)}catch{return e.preventDefault()}this.upcomingElementState=this.clampState(this.postprocessor(u,r)),r.value.length>=o&&i===l&&(s.overwriteMode==="replace"&&!J(this.upcomingElementState,r)?this.dispatchInputEvent({inputType:"insertText",data:n}):this.upcomingElementState=null)}handleEnter(e){(this.isTextArea||this.element.isContentEditable)&&this.handleInsert(e,`
`)}clampState({value:e,selection:n}){let[s,o]=n,r=this.maxLength;return{value:e.slice(0,r),selection:[Math.min(s,r),Math.min(o,r)]}}};function Re(t,e,n){let s=Math.min(Number(n),Math.max(Number(e),Number(t)));return t instanceof Date?new Date(s):s}function ft(t){return t.replaceAll(/\W/g,"").length}var De={day:31,month:12,year:9999};var pt=new Date("0001-01-01T00:00"),gt=new Date("9999-12-31T23:59:59.999"),ee={hours:23,minutes:59,seconds:59,milliseconds:999},Te={hours:0,minutes:0,seconds:0,milliseconds:0},R="\xA0";var ht=":",Et="\uFF1A",j=new RegExp(`[${R}APM]+$`,"g"),G=new RegExp(`${R}[AP]M$`,"g"),te=[":","."],Ce={hours:2,minutes:2,seconds:2,milliseconds:3};var _e=t=>{var e,n,s,o,r,i;return{day:(n=(e=t.match(/d/g))===null||e===void 0?void 0:e.length)!==null&&n!==void 0?n:0,month:(o=(s=t.match(/m/g))===null||s===void 0?void 0:s.length)!==null&&o!==void 0?o:0,year:(i=(r=t.match(/y/g))===null||r===void 0?void 0:r.length)!==null&&i!==void 0?i:0}};function yt(t){return{day:String(t.getDate()).padStart(2,"0"),month:String(t.getMonth()+1).padStart(2,"0"),year:String(t.getFullYear()).padStart(4,"0"),hours:String(t.getHours()).padStart(2,"0"),minutes:String(t.getMinutes()).padStart(2,"0"),seconds:String(t.getSeconds()).padStart(2,"0"),milliseconds:String(t.getMilliseconds()).padStart(3,"0")}}var vt=["day","month","year"];function bt(t){return[...vt].sort((e,n)=>t.indexOf(e[0])>t.indexOf(n[0])?1:-1)}function At(t,e){return t.length<e.length?!1:t.split(/\D/).every(n=>!/^0+$/.exec(n))}function Pe(t,e,n){let s=ft(e);return t.replace(n,"").match(new RegExp(`(\\D*\\d[^\\d\\s]*){1,${s}}`,"g"))||[]}function ne(t,e){let n=e.replaceAll(/[^dmy]/g,""),s=t.replaceAll(/\D+/g,""),o={day:s.slice(n.indexOf("d"),n.lastIndexOf("d")+1),month:s.slice(n.indexOf("m"),n.lastIndexOf("m")+1),year:s.slice(n.indexOf("y"),n.lastIndexOf("y")+1)};return Object.fromEntries(Object.entries(o).filter(([r,i])=>!!i).sort(([r],[i])=>e.toLowerCase().indexOf(r.slice(0,1))>e.toLowerCase().indexOf(i.slice(0,1))?1:-1))}function wt(t,e){var n,s,o,r,i,l,a;let c=((n=t.year)===null||n===void 0?void 0:n.length)===2?`20${t.year}`:t.year,u=new Date(Number(c??"0"),Number((s=t.month)!==null&&s!==void 0?s:"1")-1,Number((o=t.day)!==null&&o!==void 0?o:"1"),Number((r=e?.hours)!==null&&r!==void 0?r:"0"),Number((i=e?.minutes)!==null&&i!==void 0?i:"0"),Number((l=e?.seconds)!==null&&l!==void 0?l:"0"),Number((a=e?.milliseconds)!==null&&a!==void 0?a:"0"));return u.setFullYear(Number(c??"0")),u}var Ie=", ";function P({day:t,month:e,year:n,hours:s,minutes:o,seconds:r,milliseconds:i},{dateMode:l,dateTimeSeparator:a=Ie,timeMode:c}){var u;let d=((u=l.match(/y/g))===null||u===void 0?void 0:u.length)===2?n?.slice(-2):n;return(l+(c?a+c:"")).replaceAll(/d+/g,t??"").replaceAll(/m+/g,e??"").replaceAll(/y+/g,d??"").replaceAll(/H+/g,s??"").replaceAll("MSS",i??"").replaceAll(/M+/g,o??"").replaceAll(/S+/g,r??"").replaceAll(/^\D+/g,"").replaceAll(/\D+$/g,"")}function St({dateString:t,dateModeTemplate:e,dateSegmentsSeparator:n,offset:s,selection:[o,r]}){var i,l;let a=ne(t,e),c=Object.entries(a),u=bt(e),d={};for(let f=0;f<c.length;f++){let[p,E]=c[f],v=P(d,{dateMode:e}),S=De[p],y=v.length&&n.length,w=s+v.length+y+_e(e)[p],A=w>=o&&w===r;if(A&&Number(E)>Number(S)){let b=u[u.indexOf(p)+1];if(!b||b==="year")return{validatedDateString:"",updatedSelection:[o,r]};d[p]=`0${E.slice(0,-1)}`,c[f+1]=[b,E.slice(-1)+((l=(i=c[f+1])===null||i===void 0?void 0:i[1])!==null&&l!==void 0?l:"").slice(1)];continue}if(A&&Number(E)<1)return{validatedDateString:"",updatedSelection:[o,r]};d[p]=E}let m=P(d,{dateMode:e}),g=m.length-t.length;return{validatedDateString:m,updatedSelection:[o+g,r+g]}}function q(t){return t}function Ne(){}var ke=/[\\^$.*+?()[\]{}|]/g,Mt=new RegExp(ke.source);function W(t){return t&&Mt.test(t)?t.replaceAll(ke,String.raw`\$&`):t}function $t(t,e){let n="";for(let s=0;s<t.length;s++){if(t[s]!==e[s])return n;n+=t[s]}return n}var Lt=/^0+$/;function Y(t,e,n=0){let s=t.padEnd(e.length,"0");if(Number(s)<=Number(e))return{validatedSegmentValue:t,prefixedZeroesCount:n};if(s.endsWith("0"))return Y(`0${t.slice(0,e.length-1)}`,e,n+1);let o=t.slice(0,e.length-1);return Lt.exec(o)?{validatedSegmentValue:"",prefixedZeroesCount:n}:Y(`${o}0`,e,n)}function $e(t){return t.replaceAll(new RegExp(Et,"g"),ht)}function Le(t){return t.replaceAll(/[０-９]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248))}function xt(){return({elementState:t,data:e})=>{let{value:n,selection:s}=t;return{elementState:{selection:s,value:$e(n)},data:$e(e)}}}function Rt({dateModeTemplate:t,dateSegmentSeparator:e,splitFn:n,uniteFn:s}){return({value:o,selection:r})=>{var i;let[l,a]=r,{dateStrings:c,restPart:u=""}=n(o),d=[],m=0;c.forEach(f=>{let p=ne(f,t),v=Object.entries(p).reduce((S,[y,w])=>{let{validatedSegmentValue:A,prefixedZeroesCount:b}=Y(w,`${De[y]}`);return m+=b,Object.assign(Object.assign({},S),{[y]:A})},{});d.push(P(v,{dateMode:t}))});let g=s(d,o)+(!((i=c[c.length-1])===null||i===void 0)&&i.endsWith(e)?e:"")+u;return m&&g.slice(a+m,a+m+e.length)===e&&(m+=e.length),{selection:[l+m,a+m],value:g}}}function He(){return({elementState:t,data:e})=>{let{value:n,selection:s}=t;return{elementState:{selection:s,value:Le(n)},data:Le(e)}}}function Dt(t){return Array.from(t.replace(" AA","")).map(e=>te.includes(e)?e:/\d/).concat(t.includes("AA")?[R,/[AP]/i,/M/i]:[])}function Tt(t,e){return Object.fromEntries(Object.entries(t).map(([n,s])=>[n,e(String(s),Ce[n])]))}function Ct(t){return Tt(t,(e,n)=>e.padStart(n,"0"))}var xe={HH:"hours",MM:"minutes",SS:"seconds",MSS:"milliseconds"};function Oe(t,e){let n=t.replaceAll(/\D+/g,""),s=0;return Object.fromEntries(e.split(/\W/).filter(o=>xe[o]).map(o=>{let r=n.slice(s,s+o.length);return s+=o.length,[xe[o],r]}))}var _t=/^\D*/,Pt=/\D*$/;function It({hours:t="",minutes:e="",seconds:n="",milliseconds:s=""}){return`${t}:${e}:${n}.${s}`.replace(_t,"").replace(Pt,"")}var Nt=new RegExp(`[${te.map(W).join("")}]$`);function kt({value:t,selection:e},{mode:n,timeSegmentMaxValues:s=ee}){let[o,r]=e,i=Oe(t,n),l=Object.entries(i),a=Ct(s),c={},u=0;for(let[v,S]of l){let y=a[v],{validatedSegmentValue:w,prefixedZeroesCount:A}=Y(S,String(y));u+=A,c[v]=w}let[d=""]=t.match(/^\D+(?=\d)/g)||[],[m=""]=t.match(/\D+$/g)||[],g=d+It(c)+m,f=Math.max(g.length-t.length-u,0),p=o+u+f,E=r+u+f;return p===E&&u&&g.slice(0,E+1).match(Nt)&&(p++,E++),{value:g,selection:[p,E]}}function Ht({timeMode:t,timeSegmentMinValues:e=Te,timeSegmentMaxValues:n=ee,parseValue:s=o=>({timeString:o})}){let o=new RegExp(`[^\\d${te.map(W).join("")}]+`);return({elementState:r,data:i},l)=>{if(l!=="insert")return{elementState:r,data:i};let{value:a,selection:c}=r,[u,d]=c,m=i.replace(o,""),g=d+m.length,f=a.slice(0,u)+m+a.slice(g),{timeString:p,restValue:E=""}=s(f),v=Object.entries(Oe(p,t)),S=E.length;for(let[y,w]of v){let A=e[y],b=n[y],$=Number(w),N=S+Ce[y];if(N>=u&&N<=g&&$!==Re($,A,b))return{elementState:r,data:""};S+=w.length+1}return{elementState:r,data:i}}}function Ot(t){if(!t.includes("AA"))return q;let e=/^[AP]$/gi;return({elementState:n,data:s})=>{let{value:o,selection:r}=n,i=o.toUpperCase(),l=s.toUpperCase();return i.match(G)&&l.match(e)?{elementState:{value:i.replaceAll(G,""),selection:r},data:`${l}M`}:{elementState:{selection:r,value:i},data:l}}}function Ft(t){return t.includes("AA")?({value:e,selection:n},s)=>{if(!e.match(j)||e.match(G))return{value:e,selection:n};let[o,r]=n;if(s.value.match(G)){let a=e.replace(j,"");return{value:a,selection:[Math.min(o,a.length),Math.min(r,a.length)]}}let i=`${R}${e.includes("P")?"P":"A"}M`,l=e.replace(j,a=>a!==R?i:a);return{value:l,selection:r>=l.indexOf(i)?[l.length,l.length]:n}}:q}function Vt(t,e){let n=_e(e);return Object.fromEntries(Object.entries(t).map(([s,o])=>{let r=n[s];return[s,o.length===r&&/^0+$/.exec(o)?"1".padStart(r,"0"):o]}))}var Ut="1972";function Bt({dateModeTemplate:t,min:e=pt,max:n=gt,rangeSeparator:s="",dateSegmentSeparator:o="."}){return({value:r,selection:i})=>{let l=s&&r.endsWith(s),a=Pe(r,t,s),c="";for(let u of a){c+=c?s:"";let d=ne(u,t);if(!At(u,t)){let f=Vt(d,t),p=P(f,{dateMode:t}),E=u.endsWith(o)?o:"";c+=p+E;continue}let m=wt(Object.assign({year:Ut},d)),g=Re(m,e,n);c+=P(yt(g),{dateMode:t})}return{selection:i,value:c+(l?s:"")}}}function jt({dateModeTemplate:t,dateSegmentsSeparator:e,rangeSeparator:n="",dateTimeSeparator:s=Ie}){return({elementState:o,data:r})=>{let i=t.split(e),l=r.includes(s),a=r.slice(0,l?r.indexOf(s):1/0).split(/\D/).filter(Boolean);if(!a.length||a.length%i.length!==0)return{elementState:o,data:r};let c=a.reduce((u,d,m)=>{var g;let f=(g=i[m%i.length])!==null&&g!==void 0?g:"",p=Math.trunc(m/i.length),E=m%i.length===i.length-1;return u[p]||(u[p]=""),u[p]+=E?d:`${d.padStart(f.length,"0")}${e}`,u},[]);return{elementState:o,data:l?`${c[0]}${r.slice(r.indexOf(s))}`:c.join(n)}}}function Gt(t){let e=new RegExp(`${W(t)}$`);return t?({value:n,selection:s},o)=>{if(!n&&!o.value.endsWith(t))return{value:n,selection:s};if(!n.endsWith(t)&&!o.value.endsWith(t))return{selection:s,value:n+t};let r=o.value.replace(e,""),i=o.selection[1]>r.length,l=$t(r,n);return{selection:s,value:Array.from(t).reverse().reduce((a,c,u)=>{let d=a.length-1-u,m=l[d]===c&&i;return a[d]!==c||m?a.slice(0,d+1)+c+a.slice(d+1):a},n)}}:q}function Yt(t){return t?({value:e,selection:n},s)=>{if(e.startsWith(t)||!e&&!s.value.startsWith(t))return{value:e,selection:n};let[o,r]=n,i=Array.from(t).reduce((a,c,u)=>a[u]===c?a:a.slice(0,u)+c+a.slice(u),e),l=i.length-e.length;return{selection:[o+l,r+l],value:i}}:q}function qt({dateModeTemplate:t,dateSegmentsSeparator:e,rangeSeparator:n=""}){return({elementState:s,data:o})=>{let{value:r,selection:i}=s;if(o===e)return{elementState:s,data:i[0]===r.length?o:""};if(!o.replaceAll(/\D/g,""))return{elementState:s,data:o};let l=o.replaceAll(new RegExp(`[^\\d${W(e)}${n}]`,"g"),""),[a,c]=i,u=c+o.length,d=r.slice(0,a)+l+r.slice(u),m=Pe(d,t,n),g="",f=!!n&&d.includes(n);for(let E of m){let{validatedDateString:v,updatedSelection:S}=St({dateString:E,dateModeTemplate:t,dateSegmentsSeparator:e,offset:g.length,selection:[a,u]});if(E&&!v)return{elementState:s,data:""};u=S[1],g+=f&&!g?v+n:v}let p=g.slice(a,u);return{elementState:{selection:i,value:g.slice(0,a)+p.split(e).map(E=>"0".repeat(E.length)).join(e)+g.slice(u)},data:p}}}function Wt(t){return t<0?Ne:e=>{let n=s=>{let o=Number(e.selectionStart),r=e.value.toUpperCase();if(s.key!=="ArrowUp"&&s.key!=="ArrowDown"||o<t)return;s.preventDefault();let i=r.includes("A")?"P":r.includes("P")||s.key==="ArrowUp"?"A":"P",l=`${R}${i}M`;Q(e,{value:r.length===t?r+l:r.replace(j,l),selection:[o,o]})};return e.addEventListener("keydown",n),()=>e.removeEventListener("keydown",n)}}function zt({step:t,fullMode:e,timeSegmentMaxValues:n}){let s=Zt(e);return t<=0?Ne:o=>{let r=i=>{var l;if(i.key!=="ArrowUp"&&i.key!=="ArrowDown")return;i.preventDefault();let a=(l=o.selectionStart)!==null&&l!==void 0?l:0,c=Xt({segmentsIndexes:s,selectionStart:a});if(!c)return;let u=Kt({selection:s.get(c),value:o.value,toAdd:i.key==="ArrowUp"?t:-t,max:n[c]});Q(o,{value:u,selection:[a,a]})};return o.addEventListener("keydown",r),()=>o.removeEventListener("keydown",r)}}function Zt(t){return new Map([["hours",B(t,"HH")],["milliseconds",B(t,"MSS")],["minutes",B(t,"MM")],["seconds",B(t,"SS")]])}function B(t,e){let n=t.indexOf(e);return n===-1?[-1,-1]:[n,n+e.length]}function Xt({segmentsIndexes:t,selectionStart:e}){for(let[n,s]of t.entries()){let[o,r]=s;if(o<=e&&e<=r)return n}return null}function Kt({selection:t,value:e,toAdd:n,max:s}){let[o,r]=t,i=Number(e.slice(o,r).padEnd(r-o,"0")),l=Jt(i+n,s+1);return e.slice(0,o)+String(l).padStart(r-o,"0")+e.slice(r,e.length)}function Jt(t,e){return t<0&&(t+=Math.floor(Math.abs(t)/e+1)*e),t%e}function Fe(t=""){let e=(n,[s,o])=>o>=n.length-t.length;return({elementState:n},s)=>{let{value:o,selection:r}=n;if(!o||e(o,r))return{elementState:n};let[i,l]=r,a=o.slice(i,l).replaceAll(/\d/g,"0"),c=o.slice(0,i)+a+o.slice(l);return a.replaceAll(/\D/g,"")?s==="validation"||s==="insert"&&i===l?{elementState:{selection:r,value:c}}:{elementState:{selection:s==="deleteBackward"||s==="insert"?[i,i]:[l,l],value:c}}:{elementState:n}}}function Ve({mode:t,separator:e=".",max:n,min:s}){let o=t.split("/").join(e);return Object.assign(Object.assign({},V),{mask:Array.from(o).map(r=>e.includes(r)?r:/\d/),overwriteMode:"replace",preprocessors:[He(),Fe(),jt({dateModeTemplate:o,dateSegmentsSeparator:e}),qt({dateModeTemplate:o,dateSegmentsSeparator:e})],postprocessors:[Rt({dateModeTemplate:o,dateSegmentSeparator:e,splitFn:r=>({dateStrings:[r]}),uniteFn:([r=""])=>r}),Bt({min:s,max:n,dateModeTemplate:o,dateSegmentSeparator:e})]})}var bn=Intl.DateTimeFormat("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});function z({mode:t,timeSegmentMaxValues:e={},timeSegmentMinValues:n={},step:s=0,prefix:o="",postfix:r=""}){let i=t.includes("AA"),l=Object.assign(Object.assign(Object.assign({},ee),i?{hours:12}:{}),e),a=Object.assign(Object.assign(Object.assign({},Te),i?{hours:1}:{}),n),c=[...o,...Dt(t)];return{mask:r?({value:u})=>Qt(c,u).concat(...r):c,preprocessors:[He(),xt(),Fe(r),Ot(t),Ht({timeMode:t,timeSegmentMinValues:a,timeSegmentMaxValues:l})],postprocessors:[Ft(t),u=>kt(u,{mode:t,timeSegmentMaxValues:l}),Yt(o),Gt(r)],plugins:[zt({fullMode:t,step:s,timeSegmentMaxValues:l}),Wt(t.indexOf("AA"))],overwriteMode:"replace"}}function Qt(t,e){let n=Math.min(e.replaceAll(/\D/g,"").length,t.filter(o=>typeof o!="string").length)||1,s=t.findIndex(o=>typeof o!="string"&&!--n)+1;return t.slice(0,s)}var en="0.1.119",le=(()=>{let t=new URLSearchParams(window.location.search);if(t.has("cd-debug"))return t.get("cd-debug")==="true";try{return localStorage.getItem("cd-debug")==="true"}catch{return!1}})(),h=(...t)=>le&&console.log(...t),qe=(...t)=>le&&console.warn(...t),I=(...t)=>console.log(...t),tn=(...t)=>console.error(...t);function ce(t){let e=t.toLowerCase().trim().replace(/\s+/g," ");return e==="date:mmddyyyy"?{type:"date",pattern:"mmddyyyy"}:e==="date:ddmmyyyy"?{type:"date",pattern:"ddmmyyyy"}:e==="time:hhmm am"||e==="time:hhmm"?{type:"time",pattern:"hhmm",defaultMeridiem:"AM"}:e==="time:hhmm pm"?{type:"time",pattern:"hhmm",defaultMeridiem:"PM"}:e==="time:h:mm am"||e==="time:h:mm"?{type:"time",pattern:"h:mm",defaultMeridiem:"AM"}:e==="time:h:mm pm"?{type:"time",pattern:"h:mm",defaultMeridiem:"PM"}:e==="time:hh:mm"||e==="time:hh:mm am"?{type:"time",pattern:"hh:mm",defaultMeridiem:"AM"}:e==="time:hh:mm pm"?{type:"time",pattern:"hh:mm",defaultMeridiem:"PM"}:e==="number"?{type:"number",pattern:"number"}:e==="percent"?{type:"percent",pattern:"percent"}:null}function ue(t){if(t.type==="date"){let e=t.pattern==="mmddyyyy"?"mm/dd/yyyy":"dd/mm/yyyy";return Ve({mode:e,separator:"/"})}else{if(t.type==="time")return t.pattern==="h:mm"?t.defaultMeridiem!==void 0?{mask:[/\d/,/\d?/,":",/\d/,/\d/," ",/[APap]/,/[Mm]/],preprocessors:[({elementState:n,data:s})=>{let o=n.value.replace(/[^\d]/g,"");if(/^\d+$/.test(s)){let r=o+s;if(r.length===1)return{elementState:n,data:r+":"};if(r.length===2)return parseInt(r)>12?{elementState:n,data:r[0]+":"+r[1]}:{elementState:n,data:r+":"};if(r.length===3)return{elementState:n,data:r[0]+":"+r.slice(1)+" "+t.defaultMeridiem};if(r.length===4)return{elementState:n,data:r.slice(0,2)+":"+r.slice(2)+" "+t.defaultMeridiem}}if(/[apAP]/i.test(s)){let r=s.toUpperCase();if(r==="A"||r==="P")return{elementState:n,data:" "+r+"M"};if(r==="AM"||r==="PM")return{elementState:n,data:" "+r}}return{elementState:n,data:s}}],postprocessors:[({value:n,selection:s})=>{let o=n.match(/^(\d{1,2}):(\d{2})(\s+(AM|PM))?/i);if(o){let r=parseInt(o[1]),i=parseInt(o[2]),l=o[4]?.toUpperCase()||t.defaultMeridiem;return r<1||r>12||i>59?{value:n.slice(0,-1),selection:s}:{value:`${r}:${i.toString().padStart(2,"0")} ${l}`,selection:s}}return{value:n,selection:s}}]}:{mask:[/\d/,/\d?/,":",/\d/,/\d/],preprocessors:[({elementState:n,data:s})=>{if(/^\d+$/.test(s)){let r=n.value.replace(/[^\d]/g,"")+s;if(r.length===1)return{elementState:n,data:r+":"};if(r.length===3)return{elementState:n,data:r[0]+":"+r.slice(1)};if(r.length===4)return{elementState:n,data:r.slice(0,2)+":"+r.slice(2)}}return{elementState:n,data:s}}]}:t.pattern==="hh:mm"?t.defaultMeridiem!==void 0?z({mode:"HH:MM AA"}):z({mode:"HH:MM"}):z({mode:"HH:MM AA"});if(t.type==="number")return{mask:/^-?\d+(,\d{3})*(\.\d+)?$/,preprocessors:[({elementState:e,data:n})=>{let s=e.value.replace(/,/g,""),o=n.replace(/,/g,"");return{elementState:{...e,value:s},data:o}}],postprocessors:[({value:e,selection:n})=>{if(e&&/^-?\d+(\.\d*)?$/.test(e)){let s=e.split("."),o=s[0],r=s[1],i=o.replace(/\B(?=(\d{3})+(?!\d))/g,",");return{value:r!==void 0?`${i}.${r}`:i,selection:[n[0],n[1]]}}return{value:e,selection:n}}]};if(t.type==="percent")return{mask:/^\d{0,3}(\.\d{0,2})?%?$/,preprocessors:[({elementState:e,data:n})=>{let s=e.value.replace("%",""),o=n.replace("%","");return{elementState:{...e,value:s},data:o}}],postprocessors:[({value:e,selection:n})=>e&&!e.endsWith("%")?{value:e+"%",selection:[n[0],n[1]]}:{value:e,selection:n}]}}return null}function nn(t){t.querySelectorAll("input[data-input]").forEach((n,s)=>{let o=n,r=o.getAttribute("data-input");if(!r)return;let i=ce(r);if(!i)return;let l=ue(i);if(!l)return;let a=new x(o,l);o.dispatchEvent(new CustomEvent("cd:inputformat:bound",{bubbles:!0}));let c=o.value;o.addEventListener("input",()=>{let u=o.value;u!==c&&(o.dispatchEvent(new CustomEvent("cd:inputformat:changed",{bubbles:!0,detail:{raw:c,formatted:u}})),c=u)}),o.addEventListener("blur",()=>{let u=o.value.length===0||o.checkValidity();o.setAttribute("aria-invalid",(!u).toString()),u||o.dispatchEvent(new CustomEvent("cd:inputformat:invalid",{bubbles:!0}))}),o.__maskito=a})}function sn(){let t=document.querySelectorAll("[data-show-when]"),e=new Map;t.forEach((n,s)=>{let o=n.getAttribute("data-show-when");if(!o)return;let[r,i]=o.split("=").map(l=>l.trim());!r||i===void 0||(e.has(r)||e.set(r,new Set),e.get(r).add(n),Ue(n,r,i))}),e.forEach((n,s)=>{document.querySelectorAll(`input[name="${s}"], select[name="${s}"], textarea[name="${s}"]`).forEach(r=>{r.addEventListener("change",()=>{n.forEach(i=>{let l=i.getAttribute("data-show-when");if(!l)return;let[,a]=l.split("=").map(c=>c.trim());Ue(i,s,a)})})})})}function Ue(t,e,n){let s=document.querySelectorAll(`input[name="${e}"], select[name="${e}"], textarea[name="${e}"]`),o="";s.forEach(l=>{let a=l;if(a.type==="radio"||a.type==="checkbox"){let c=a;c.checked&&(o=c.value)}else o=a.value});let r=o===n,i=t;r?(i.style.display="",i.removeAttribute("aria-hidden"),i.querySelectorAll("input, select, textarea, button, [tabindex]").forEach(a=>{a.removeAttribute("tabindex")}),t.dispatchEvent(new CustomEvent("form-wrapper-visibility:shown",{bubbles:!0}))):(i.style.display="none",i.setAttribute("aria-hidden","true"),i.querySelectorAll('input, select, textarea, button, [tabindex]:not([tabindex="-1"])').forEach(a=>{a.setAttribute("tabindex","-1")}),t.dispatchEvent(new CustomEvent("form-wrapper-visibility:hidden",{bubbles:!0})))}var Z=new Map;function on(){I("\u{1F504} Initializing Dynamic Rows...");let t=document.querySelectorAll("[data-cd-repeat-group]");if(h("\u{1F50D} Found repeat groups:",t.length),t.length===0){qe("\u26A0\uFE0F No elements found with data-cd-repeat-group attribute");let e=document.querySelectorAll("[data-repeat-group], [data-cd-repeater-group], [data-repeater-group]");h("\u{1F50D} Found elements with similar attributes:",e.length),e.length>0&&(h("\u{1F50D} First possible group:",e[0]),h("\u{1F50D} Its attributes:",Array.from(e[0].attributes).map(n=>`${n.name}="${n.value}"`)));return}t.forEach((e,n)=>{h(`\u{1F3AF} Processing Group ${n+1}:`,e.tagName,e.className);let s=e.getAttribute("data-cd-repeat-group");if(h("\u{1F50D} Group name:",s),!s){tn("\u274C No group name found, skipping");return}let o=window.getComputedStyle(e),r=o.display==="none";if(h("\u{1F50D} Container display/hidden:",o.display,r),r){h("\u23ED\uFE0F Skipping hidden container (will reinitialize when shown)");return}h("\u2705 Proceeding to initialize group:",s),We(s,e)}),I("\u2705 Dynamic rows initialization complete")}function We(t,e){let n=e.querySelector("[data-cd-repeat-template]"),s=e.querySelector("[data-cd-add-row]")||e.querySelector(`[data-cd-repeat-add="${t}"]`);if(!s&&(e.parentElement&&(s=e.parentElement.querySelector(`[data-cd-repeat-add="${t}"]`)||e.parentElement.querySelector("[data-cd-add-row]")),s||(s=document.querySelector(`[data-cd-repeat-add="${t}"]`)),!s)){let a=document.querySelectorAll("[data-cd-add-row], [data-cd-repeat-add]");for(let c of Array.from(a)){let u=c.getAttribute("data-cd-repeat-add"),d=c.getAttribute("data-cd-add-row");if(u===t||d===t||c.textContent?.toLowerCase().includes(t.toLowerCase())){s=c;break}}}let o=e.getAttribute("data-cd-name-pattern")||`${t}[{i}][{field}]`;if(h(`\u{1F527} Initializing group: "${t}"`,e.tagName,!!n,!!s),!s){qe(`\u274C No add button found for group "${t}". Checked selectors: [data-cd-add-row], [data-cd-repeat-add="${t}"]`);let a=document.querySelectorAll("[data-cd-add-row], [data-cd-repeat-add]");h("\u{1F50D} Total add buttons in document:",a.length),le&&a.length>0&&a.forEach((c,u)=>{h(`  ${u+1}. ${c.tagName} - data-cd-repeat-add: "${c.getAttribute("data-cd-repeat-add")}" - data-cd-add-row: "${c.getAttribute("data-cd-add-row")}"`)})}if(n)console.log("\u2705 Template found:",n.tagName,n.className),n.style.display="none";else{h("\u{1F50D} No template found, searching for existing rows...");let a=e.querySelector("[data-cd-repeat-row]");if(h("\u{1F50D} First existing row found:",!!a),a){h("\u{1F50D} First row details:",a.tagName,a.className),n=a.cloneNode(!0),n.setAttribute("data-cd-repeat-template","");let c=n.querySelectorAll("input, select, textarea");h("\u{1F50D} Clearing",c.length,"input values in template"),c.forEach(u=>{u.value=""}),n.style.display="none",e.insertBefore(n,a),h(`\u2705 Created and hid template from first row for group "${t}"`)}else{console.log("\u{1F50D} Searching for elements with similar row attributes...");let c=e.querySelectorAll("[data-repeat-row], [data-cd-repeater-row], [data-repeater-row]");console.log("\u{1F50D} Found possible rows:",c.length),c.length>0&&(console.log("\u{1F50D} First possible row:",c[0]),console.log("\u{1F50D} Its attributes:",Array.from(c[0].attributes).map(u=>`${u.name}="${u.value}"`)))}}if(!n){console.error("\u274C No template available, cannot initialize group");return}let r=Array.from(e.querySelectorAll("[data-cd-repeat-row]:not([data-cd-repeat-template])"));if(console.log("\u{1F50D} Found existing data rows:",r.length),r.forEach((a,c)=>{console.log(`\u{1F50D} Existing row ${c+1}:`,{tag:a.tagName,class:a.className,"data-cd-repeat-row":a.getAttribute("data-cd-repeat-row")})}),r.length===0){console.log("\u{1F50D} No existing data rows, creating first row from template...");let a=n.cloneNode(!0);a.removeAttribute("data-cd-repeat-template"),a.style.display="",e.appendChild(a),r.push(a)}else if(r.forEach((a,c)=>{let u=a;c===0?(u.style.display="",u.removeAttribute("aria-hidden"),console.log(`\u{1F50D} Keeping first row visible: row ${c+1}`)):(u.style.display="none",u.setAttribute("aria-hidden","true"),console.log(`\u{1F50D} Hiding extra row: row ${c+1}`))}),r.length>1){console.log(`\u{1F50D} Removing ${r.length-1} extra rows from DOM`);for(let a=1;a<r.length;a++)r[a].remove();r.splice(1)}let i={groupName:t,container:e,template:n,namePattern:o,rows:r,addButton:s};Z.set(t,i),s?(console.log(`\u2795 Attaching add button listener for group "${t}"`),s.removeEventListener("click",Be),s.addEventListener("click",Be)):console.warn(`\u274C No add button found for group "${t}". Checked selectors: [data-cd-add-row], [data-cd-repeat-add="${t}"]`);let l=e.querySelectorAll("[data-cd-remove-row], [data-cd-repeat-remove]");console.log(`\u{1F517} Found ${l.length} remove buttons for group "${t}"`),l.forEach(a=>{let c=a.getAttribute("data-cd-repeat-remove");c&&console.log(`\u{1F517} Remove button references group: "${c}" (should be "${t}")`),a.removeEventListener("click",re),a.addEventListener("click",re)}),rn(i),de(i),me(i)}function rn(t){console.log(`\u{1F3A8} Applying formatting to ${t.rows.length} existing rows in group "${t.groupName}"`),t.rows.forEach((e,n)=>{let s=e.querySelectorAll("input[data-input]");console.log(`\u{1F3A8} Row ${n+1}: found ${s.length} inputs with data-input attribute`),s.forEach(o=>{let r=o,i=r.getAttribute("data-input");if(!i)return;console.log(`\u{1F3A8} Applying formatting to input: data-input="${i}"`);let l=ce(i);if(l){let a=ue(l);if(a){r.__maskito&&r.__maskito.destroy();let c=new x(r,a);r.__maskito=c,r.dispatchEvent(new CustomEvent("cd:inputformat:bound",{bubbles:!0})),console.log(`\u2705 Maskito applied to existing input with data-input="${i}"`)}}})})}function Be(t){console.log("\u{1F5B1}\uFE0F Add button clicked!",t.target),t.preventDefault();let e=t.target,n=e.closest("[data-cd-repeat-add]")||e.closest("[data-cd-add-row]");if(console.log("\u{1F50D} Event details:",{clickedElement:e.tagName,clickedClass:e.className,foundButton:!!n,buttonAttr:n?n.getAttribute("data-cd-repeat-add")||n.getAttribute("data-cd-add-row"):"none"}),!n){console.error("\u274C No add button found from clicked element");return}let s=n.getAttribute("data-cd-repeat-add")||n.getAttribute("data-cd-add-row");if(console.log("\u{1F50D} Searching for container from button:",{button:n.tagName,buttonClass:n.className,groupName:s}),!s){console.error("\u274C No group name found on add button");return}let o=document.querySelector(`[data-cd-repeat-group="${s}"]`);if(console.log("\u{1F50D} Container lookup result:",{groupName:s,containerFound:!!o}),!o){console.error(`\u274C No container found for group "${s}"`);return}console.log(`\u{1F4DD} Found container for group: "${s}"`);let r=Z.get(s);if(console.log("\u{1F4E6} Retrieved group:",!!r),!r){console.error(`\u274C No group found in activeGroups for "${s}"`);return}an(r)}function re(t){t.preventDefault();let e=t.target,n=e.closest("[data-cd-repeat-group]");if(!n)return;let s=n.getAttribute("data-cd-repeat-group");if(!s)return;let o=Z.get(s);if(!o)return;let r=cn(o,e);r&&un(o,r.row)}function an(t){if(console.log(`\u2795 Adding new row to group "${t.groupName}" (currently ${t.rows.length} rows)`),t.rows.length>=5){console.log(`\u26A0\uFE0F Maximum rows reached for group "${t.groupName}" (5 rows max)`),t.addButton&&(t.addButton.style.opacity="0.5",t.addButton.style.pointerEvents="none",console.log(`\u{1F6AB} Add button disabled for group "${t.groupName}"`));return}let e=t.container.querySelector("[data-cd-repeat-template]");if(!e){console.error("\u274C No template found to clone");return}let n=e.cloneNode(!0);n.removeAttribute("data-cd-repeat-template"),n.querySelectorAll("input, select, textarea").forEach(i=>{let l=i;l.value="";let a=l.getAttribute("data-input");if(a){console.log(`\u2795 Applying formatting to new input: data-input="${a}"`);let c=ce(a);if(c){let u=ue(c);if(u){l.__maskito&&l.__maskito.destroy();let d=new x(l,u);l.__maskito=d,l.dispatchEvent(new CustomEvent("cd:inputformat:bound",{bubbles:!0})),console.log(`\u2705 Maskito applied to new input with data-input="${a}"`)}}}});let o=n;console.log(`\u2795 Before visibility fix - classes: ${o.className}, inline style: ${o.style.display}`),o.classList.add("visible-row"),o.style.display="",o.removeAttribute("aria-hidden"),console.log(`\u2795 After visibility fix - classes: ${o.className}, inline style: ${o.style.display}`),t.container.appendChild(n),t.rows.push(n);let r=n.querySelectorAll("[data-cd-remove-row], [data-cd-repeat-remove]");console.log(`\u2795 Attaching ${r.length} remove button listeners to new row`),r.forEach(i=>{i.addEventListener("click",re)}),gn(n),de(t),me(t),console.log(`\u2795 Row added successfully, new total: ${t.rows.length} rows`),t.rows.length>=5&&t.addButton&&(t.addButton.style.opacity="0.5",t.addButton.style.pointerEvents="none",console.log(`\u{1F6AB} Add button disabled for group "${t.groupName}" after reaching maximum (${t.rows.length} rows)`)),n.dispatchEvent(new CustomEvent("cd:row:added",{bubbles:!0,detail:{groupName:t.groupName,rowIndex:t.rows.length-1}}))}function de(t){console.log(`\u{1F522} DYNAMIC: Reindexing ${t.rows.length} rows for group "${t.groupName}"`),t.rows.forEach((e,n)=>{let s=n+1,o=e.querySelectorAll("[data-cd-repeat-name]");console.log(`\u{1F522} DYNAMIC: Row ${s}: found ${o.length} inputs with data-cd-repeat-name`),o.forEach(l=>{let a=l.getAttribute("data-cd-repeat-name");if(a){let c=`${a}-${s}`;l.name=c,console.log(`\u{1F522} DYNAMIC: Row ${s}: Updated input name: ${a} \u2192 ${c}`)}}),e.querySelectorAll("[id]").forEach(l=>{let a=l.getAttribute("data-original-id");a?l.id=`${a}-${s}`:l.id.endsWith(`-${s}`)||(l.setAttribute("data-original-id",l.id),l.id=`${l.id}-${s}`)}),e.querySelectorAll("label[for]").forEach(l=>{let a=l.getAttribute("data-original-for");if(a)l.htmlFor=`${a}-${s}`;else{let c=l.htmlFor;c.endsWith(`-${s}`)||(l.setAttribute("data-original-for",c),l.htmlFor=`${c}-${s}`)}})}),console.log("\u{1F522} DYNAMIC: Dispatching input events to trigger summary updates"),t.rows.forEach((e,n)=>{let s=e.querySelectorAll("input, select, textarea");console.log(`\u{1F522} DYNAMIC: Row ${n+1}: dispatching events for ${s.length} inputs`),s.forEach(o=>{o.dispatchEvent(new Event("input",{bubbles:!0}))})}),console.log("\u{1F522} DYNAMIC: Summary fields will be synced by updateSummaries()")}function me(t){console.log(`\u{1F4CA} SUMMARY: Updating summaries for group "${t.groupName}" (${t.rows.length} rows)`);let e=document.querySelectorAll(`[data-cd-summary-for="${t.groupName}"]`);console.log(`\u{1F4CA} SUMMARY: Found ${e.length} summary container(s) for group "${t.groupName}"`),e.forEach((n,s)=>{let o=n.querySelector("[data-cd-summary-template]");if(!o){console.warn(`\u{1F4CA} SUMMARY: No template found in summary container ${s} for group "${t.groupName}"`);return}let r=n.querySelectorAll("[data-summary-row]");console.log(`\u{1F4CA} SUMMARY: Removing ${r.length} existing summary rows from container ${s}`),r.forEach(i=>i.remove()),console.log(`\u{1F4CA} SUMMARY: Creating ${t.rows.length} new summary rows for container ${s}`),t.rows.forEach((i,l)=>{let a=l+1,c=o.cloneNode(!0);c.removeAttribute("data-cd-summary-template"),c.setAttribute("data-summary-row",""),c.style.display="";let u=c.querySelectorAll("[data-cd-input-field]");console.log(`\u{1F4CA} SUMMARY: Processing ${u.length} field elements in summary row ${a}`),u.forEach(d=>{let m=d.getAttribute("data-cd-input-field");if(m){let g=m.replace("{i}",a.toString());d.setAttribute("data-cd-input-field",g),console.log(`\u{1F4CA} SUMMARY: Updated field: ${m} \u2192 ${g}`)}}),n.appendChild(c)}),o&&(o.style.display="none",console.log(`\u{1F4CA} SUMMARY: Summary template hidden for container ${s}`))}),ln(),typeof window.TryFormly?.refresh=="function"?(console.log("\u{1F4CA} SUMMARY: Triggering TryFormly.refresh()"),window.TryFormly.refresh()):console.log("\u{1F4CA} SUMMARY: TryFormly.refresh() not available")}function ln(){console.log("\u{1F504} SUMMARY: Syncing all summary fields...");let t=document.querySelectorAll("[data-cd-input-field]");console.log(`\u{1F504} SUMMARY: Found ${t.length} summary field elements`),t.forEach((e,n)=>{let s=e.getAttribute("data-cd-input-field");s&&(console.log(`\u{1F504} SUMMARY: Syncing field ${n+1}: "${s}"`),ie(e,s))})}function ie(t,e){let n=null;if(console.log(`\u{1F50D} SUMMARY: Syncing summary field: "${e}"`),e.includes("{i}")){console.log(`\u{1F50D} SUMMARY: Templated field detected: "${e}"`);let r=t.closest("[data-summary-row]");if(r){let i=r.parentElement,a=Array.from(i?.querySelectorAll("[data-summary-row]")||[]).indexOf(r)+1,c=e.replace("{i}",a.toString());if(c.includes("[")&&c.includes("]")){let u=c.match(/\[(\d+)\]\[([^\]]+)\]/);if(u){let d=u[1];c=`${u[2]}-${d}`,console.log(`\u{1F50D} SUMMARY: Converted bracket pattern: "${e}" \u2192 "${c}"`)}}console.log(`\u{1F50D} SUMMARY: Resolved templated field: "${e}" \u2192 "${c}"`),e=c}else{console.log(`\u{1F50D} SUMMARY: Could not resolve templated field "${e}" - no summary row context found`);return}}let s=[`input[name="${e}"]:not([data-cd-repeat-template])`,`select[name="${e}"]:not([data-cd-repeat-template])`,`textarea[name="${e}"]:not([data-cd-repeat-template])`,`input[name="${e}"]`,`select[name="${e}"]`,`textarea[name="${e}"]`,`input[id="${e}"]`,`select[id="${e}"]`,`textarea[id="${e}"]`];for(let r of s){let i=document.querySelectorAll(r);for(let l of Array.from(i))if(l.offsetParent!==null){n=l,console.log(`\u{1F50D} Found visible source using selector: ${r}`);break}if(n)break;if(i.length>0&&!n){n=i[0],console.log(`\u{1F50D} Found source using selector (fallback): ${r}`);break}}if(!n){console.log(`\u{1F50D} SUMMARY: Direct match failed for field: "${e}"`);let l=Array.from(document.querySelectorAll("input[name], select[name], textarea[name]")).filter(a=>{let c=a.getAttribute("name");return c&&c.includes("-")}).map(a=>a.getAttribute("name"));console.log("\u{1F50D} SUMMARY: Available dynamic input names (with suffix pattern):",l),console.log(`\u{1F50D} SUMMARY: Looking for field name: "${e}"`);return}console.log(`\u{1F50D} SUMMARY: Found source element for "${e}":`,n.tagName,n.type||"");let o="";if(n.tagName.toLowerCase()==="input"||n.tagName.toLowerCase()==="textarea"){let r=n;console.log(`\u{1F50D} SUMMARY DEBUG: Input element value: "${r.value}"`),console.log(`\u{1F50D} SUMMARY DEBUG: Input element name: "${r.name}"`),console.log(`\u{1F50D} SUMMARY DEBUG: Input element id: "${r.id}"`),console.log(`\u{1F50D} SUMMARY DEBUG: Element visibility: display="${r.style.display}", parent visible="${r.offsetParent!==null}"`),console.log(`\u{1F50D} SUMMARY DEBUG: Element classes: "${r.className}"`);let i=document.querySelectorAll(`[name="${e}"]`);console.log(`\u{1F50D} SUMMARY DEBUG: Found ${i.length} elements with name="${e}"`),i.length>1&&i.forEach((l,a)=>{let c=l;console.log(`\u{1F50D} SUMMARY DEBUG: Element ${a+1}: value="${l.value}", visible="${c.offsetParent!==null}", classes="${c.className}"`)})}if(n.type==="radio"){let r=document.querySelector(`input[name="${e}"]:checked`);o=r?r.value:""}else n.type==="checkbox"?o=n.checked?"Yes":"No":o=n.value;if(t.textContent=o||"[Not specified]",console.log(`\u2705 SUMMARY: Updated summary for "${e}": "${o}"`),!n.__summaryListenerAdded){let r=n.type==="radio"||n.type==="checkbox"?"change":"input";n.addEventListener(r,()=>{console.log(`\u{1F504} SUMMARY: Field "${e}" changed, updating summary...`),ie(t,e)}),n.type==="radio"&&document.querySelectorAll(`input[name="${e}"]`).forEach(l=>{l.__summaryListenerAdded||(l.addEventListener("change",()=>{console.log(`\u{1F504} SUMMARY: Radio "${e}" changed, updating summary...`),ie(t,e)}),l.__summaryListenerAdded=!0)}),n.__summaryListenerAdded=!0,console.log(`\u{1F3A7} SUMMARY: Added ${r} listener for field "${e}"`)}}function cn(t,e){for(let n=0;n<t.rows.length;n++){let s=t.rows[n];if(s.contains(e))return{row:s,index:n}}return null}function un(t,e){if(console.log(`\u2796 Removing row from group "${t.groupName}" (currently ${t.rows.length} rows)`),t.rows.length<=1){console.warn("Cannot remove last row from group:",t.groupName);return}let n=t.rows.indexOf(e);if(n===-1){console.warn("Target row not found in group:",t.groupName);return}console.log(`\u2796 Removing row at index ${n}`),e.remove(),t.rows.splice(n,1),t.rows.length<5&&t.addButton&&(t.addButton.style.opacity="",t.addButton.style.pointerEvents="",console.log(`\u2705 Add button re-enabled for group "${t.groupName}"`)),de(t),me(t),console.log(`\u2796 Row removed successfully, new total: ${t.rows.length} rows`),e.dispatchEvent(new CustomEvent("cd:row:removed",{bubbles:!0,detail:{groupName:t.groupName,rowIndex:n,removedRow:e}}))}function dn(t,e){We(t,e)}var je="tooltip_component",ze="tooltip_element-wrapper",Ge="tooltip_tooltip-wrapper",Ye="tooltip_pointer",se={bottom:"top",top:"bottom",left:"right",right:"left"},mn={top:{start:"left",end:"right",len:"width",translate:"translateX"},bottom:{start:"left",end:"right",len:"width",translate:"translateX"},left:{start:"top",end:"bottom",len:"height",translate:"translateY"},right:{start:"top",end:"bottom",len:"height",translate:"translateY"}};function fn(t){let e=t.closest(`.${je}`);if(e)return{mode:"standard",comp:e,panel:e.querySelector(`.${Ge}`),pointer:e.querySelector(`.${Ye}`)};let n=t.closest("[data-tt-group]")||t.parentElement,s=t.getAttribute("data-tt"),o=s?n.querySelector(`.${je}[data-tt-for="${s}"]`):null;return{mode:"split",comp:o,panel:o?.querySelector(`.${Ge}`),pointer:o?.querySelector(`.${Ye}`)}}function Ze(t){if(t.dataset._ttSetup)return;t.dataset._ttSetup="1";let e=fn(t),{mode:n,comp:s,panel:o,pointer:r}=e;if(!o||!r)return;let i=r.className.includes("is-left")?"left":r.className.includes("is-right")?"right":r.className.includes("is-bottom")?"bottom":"top";function l(){o&&(o.style.display="block",o.style.opacity="1")}function a(){o&&(o.style.opacity="0",o.style.display="none")}let c=!1,u=0;function d(){if(!c||!o||!r)return;requestAnimationFrame(d);let f=t.getBoundingClientRect(),p=o.getBoundingClientRect(),E=document.documentElement.clientWidth,v=document.documentElement.clientHeight,S={bottom:f.bottom+p.height<v,top:f.top-p.height>0,left:f.left-p.width>0,right:f.right+p.width<E},y=S[i]||!S[se[i]]?i:se[i];if(n==="standard"){let L=mn[y],fe=se[y],k=f[L.start],pe=f[L.end],ge=p[L.len],he=(k+pe-ge)/2,Ee=(k+pe+ge)/2,H=0,ye=y==="left"||y==="right"?v:E;he<0?H=-he:ye<Ee&&(H=ye-Ee),o.style.position="",o.style.transform=L.translate+"("+H+"px)",r.style.transform=L.translate+"("+-H+"px) rotate(45deg)";return}o.style.position="fixed";let w=8,A=Math.round(f.left+f.width/2-p.width/2),b=0;y==="bottom"?b=Math.round(f.bottom+w):y==="top"?b=Math.round(f.top-w-p.height):y==="left"?(b=Math.round(f.top+f.height/2-p.height/2),A=Math.round(f.left-w-p.width)):(b=Math.round(f.top+f.height/2-p.height/2),A=Math.round(f.right+w));let $=8;A=Math.max($,Math.min(A,E-p.width-$)),b=Math.max($,Math.min(b,v-p.height-$)),o.style.left=A+"px",o.style.top=b+"px",o.style.right="",o.style.bottom="",o.style.transform="none";let N=f.left+f.width/2,Je=A+p.width/2,Qe=N-Je;if(y==="top"||y==="bottom")r.style.transform="translateX("+Qe+"px) rotate(45deg)";else{let L=f.top+f.height/2,fe=b+p.height/2,k=L-fe;r.style.transform="translateY("+k+"px) rotate(45deg)"}}function m(){++u===1&&(l(),c=!0,d())}function g(){u>0&&--u===0&&(c=!1,a())}t.addEventListener("mouseenter",m),t.addEventListener("mouseleave",g),(s||o).addEventListener("mouseenter",m),(s||o).addEventListener("mouseleave",g),t.setAttribute("tabindex","0"),t.addEventListener("focus",m),t.addEventListener("blur",g),t.addEventListener("keydown",f=>{f.key==="Escape"&&g()})}function pn(t){h("\u{1F4AC} Initializing tooltips for form...");let e=t.querySelectorAll(`.${ze}`);h(`\u{1F4AC} Found ${e.length} tooltip triggers`),e.forEach(n=>Ze(n)),I(`\u2705 Tooltips initialized (${e.length} triggers)`)}function gn(t){h("\u{1F4AC} Reinitializing tooltips in new row...");let e=t.querySelectorAll(`.${ze}`);h(`\u{1F4AC} Found ${e.length} tooltip triggers in row`),e.forEach(n=>Ze(n))}document.addEventListener("form-wrapper-visibility:shown",t=>{t.target.querySelectorAll("[data-cd-repeat-group]").forEach(s=>{let o=s.getAttribute("data-cd-repeat-group");o&&dn(o,s)})});var Xe={};function hn(){I("\u{1F33F} Initializing Branch-Based Summary Visibility...");let t=document.querySelectorAll("[data-cd-summary-branch]");h(`\u{1F33F} Found ${t.length} branch summary elements to hide by default`),t.forEach((n,s)=>{let o=n;o.style.display="none",o.setAttribute("aria-hidden","true"),h(`\u{1F33F} Hidden branch summary ${s+1}: ${o.tagName}.${o.className}`)}),new MutationObserver(n=>{n.forEach(s=>{s.type==="attributes"&&s.attributeName==="style"&&s.target.matches(".step_wrapper[data-cd-branch]")&&oe()}),n.forEach(s=>{s.addedNodes.forEach(o=>{if(o.nodeType===1){let r=o;r.matches&&r.matches(".step_wrapper[data-cd-branch]")&&oe()}})})}).observe(document.body,{attributes:!0,attributeFilter:["style"],childList:!0,subtree:!0}),oe(),En(),I("\u2705 Branch-based summary visibility initialization complete")}function oe(){h("\u{1F33F} BRANCH: Checking branch wrapper visibility..."),document.querySelectorAll(".step_wrapper[data-cd-branch]").forEach(e=>{let n=e;if(window.getComputedStyle(n).display!=="none"&&n.offsetParent!==null){let r=e.getAttribute("data-cd-branch"),i=e.getAttribute("data-answer");r&&i&&(Xe[r]=i,h(`\u{1F33F} BRANCH: Selected ${r} = ${i}`),Ke(r,i))}})}function Ke(t,e){h(`\u{1F33F} BRANCH: Updating summary visibility for ${t}:${e}`);let n=document.querySelectorAll(`[data-cd-summary-branch^="${t}:"]`);h(`\u{1F33F} BRANCH: Found ${n.length} summary sections for branch group "${t}"`),n.forEach((s,o)=>{let r=s.getAttribute("data-cd-summary-branch"),i=s;if(!r)return;let[l,a]=r.split(":"),c=l===t&&a===e;h(`\u{1F33F} BRANCH: Section ${o+1} (${r}): ${c?"SHOW":"HIDE"}`),c?(i.style.display="",i.removeAttribute("aria-hidden"),i.querySelectorAll("input, select, textarea, button, [tabindex]").forEach(d=>{d.removeAttribute("tabindex")}),s.dispatchEvent(new CustomEvent("cd:branch-summary:shown",{bubbles:!0,detail:{branchGroup:t,branchValue:e,summaryBranchAttr:r}}))):l===t&&(i.style.display="none",i.setAttribute("aria-hidden","true"),i.querySelectorAll('input, select, textarea, button, [tabindex]:not([tabindex="-1"])').forEach(d=>{d.setAttribute("tabindex","-1")}),s.dispatchEvent(new CustomEvent("cd:branch-summary:hidden",{bubbles:!0,detail:{branchGroup:t,branchValue:e,summaryBranchAttr:r}})))})}function En(){h("\u{1F33F} BRANCH: Updating all summary visibility based on selected branches"),Object.entries(Xe).forEach(([t,e])=>{Ke(t,e)})}function ae(){let t=document.querySelectorAll('form[data-cd-form="true"]');t.length!==0&&t.forEach((e,n)=>{let s=e;try{nn(s),sn(),on(),hn(),pn(s),s.dispatchEvent(new CustomEvent("cdForm:validated",{bubbles:!0}))}catch(o){console.error("\u274C Error enhancing form:",o),o instanceof Error&&console.error("\u274C Stack trace:",o.stack)}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ae):ae();window.CDFormLibrary={version:en,initialize:ae,dynamicRows:Z};})();
